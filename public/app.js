!function(){"use strict";var e="undefined"==typeof global?self:global;if("function"!=typeof e.require){var t={},s={},i={},r={}.hasOwnProperty,o=/^\.\.?(\/|$)/,n=function(e,t){for(var s,i=[],r=(o.test(t)?e+"/"+t:t).split("/"),n=0,a=r.length;n<a;n++)s=r[n],".."===s?i.pop():"."!==s&&""!==s&&i.push(s);return i.join("/")},a=function(e){return e.split("/").slice(0,-1).join("/")},c=function(t){return function(s){var i=n(a(t),s);return e.require(i,t)}},l=function(e,t){var i=g&&g.createHot(e),r={id:e,exports:{},hot:i};return s[e]=r,t(r.exports,c(e),r),r.exports},d=function(e){return i[e]?d(i[e]):e},u=function(e,t){return d(n(a(e),t))},h=function(e,i){null==i&&(i="/");var o=d(e);if(r.call(s,o))return s[o].exports;if(r.call(t,o))return l(o,t[o]);throw new Error("Cannot find module '"+e+"' from '"+i+"'")};h.alias=function(e,t){i[t]=e};var f=/\.[^.\/]+$/,p=/\/index(\.[^\/]+)?$/,y=function(e){if(f.test(e)){var t=e.replace(f,"");r.call(i,t)&&i[t].replace(f,"")!==t+"/index"||(i[t]=e)}if(p.test(e)){var s=e.replace(p,"");r.call(i,s)||(i[s]=e)}};h.register=h.define=function(e,i){if(e&&"object"==typeof e)for(var o in e)r.call(e,o)&&h.register(o,e[o]);else t[e]=i,delete s[e],y(e)},h.list=function(){var e=[];for(var s in t)r.call(t,s)&&e.push(s);return e};var g=e._hmr&&new e._hmr(u,h,t,s);h._cache=s,h.hmr=g&&g.wrap,h.brunch=!0,e.require=h}}(),function(){"undefined"==typeof window?this:window;require.register("data/const.js",function(e,t,s){s.exports=Object.freeze({colors:Object.freeze({aqua:"#62f6ff",black:"#000",yellow:"#fed141",white:"#fff"}),fonts:Object.freeze({"default":"Futura, system-ui, sans-serif"}),hexColors:Object.freeze({darkGray:2236962,red:16720384,white:16777215})})}),require.register("initialize.js",function(e,t,s){window.game=new Phaser.Game({width:800,height:600,type:Phaser.AUTO,title:"☕️ Brunch with Phaser",url:"https://github.com/samme/brunch-phaser",version:"0.0.1",banner:{background:["#e54661","#ffa644","#998a2f","#2c594f","#002d40"]},loader:{path:"assets/"},physics:{"default":"arcade",arcade:{gravity:{y:300}}},callbacks:{postBoot:function(e){console.debug("game.config",e.config)}},scene:[t("scenes/boot"),t("scenes/default"),t("scenes/menu")]})}),require.register("scenes/boot.js",function(e,t,s){var i=t("data/const");s.exports={key:"boot",preload:function(){this.load.image("sky","sky.png"),this.load.image("ground","platform.png"),this.load.image("star","star.png"),this.load.image("bomb","bomb.png"),this.load.spritesheet("dude","dude.png",{frameWidth:32,frameHeight:48}),this.load.on("progress",this.onLoadProgress,this),this.load.on("complete",this.onLoadComplete,this),this.createProgressBar()},create:function(){this.registry.set("score",0),this.scene.start("menu")},extend:{progressBar:null,progressCompleteRect:null,progressRect:null,createProgressBar:function(){var e=Phaser.Geom.Rectangle,t=e.Clone(this.cameras.main);this.progressRect=new e(0,0,.5*t.width,50),e.CenterOn(this.progressRect,t.centerX,t.centerY),this.progressCompleteRect=e.Clone(this.progressRect),this.progressBar=this.add.graphics()},onLoadComplete:function(e,t,s){console.debug("complete",t),console.debug("failed",s),this.progressBar.destroy()},onLoadProgress:function(e){console.debug("progress",e),this.progressRect.width=e*this.progressCompleteRect.width,this.progressBar.clear().fillStyle(i.hexColors.darkGray).fillRectShape(this.progressCompleteRect).fillStyle(this.load.totalFailed?i.hexColors.red:i.hexColors.white).fillRectShape(this.progressRect)}}}}),require.register("scenes/default.js",function(e,t,s){var i,r,o,n,a,c,l,d,u;t("data/const");s.exports={key:"default",init:function(e){console.debug("init",this.scene.key,e,this),this.events.once("shutdown",this.shutdown,this),this.score=0},create:function(){var e=this;u=io(),u.on("connect",function(){console.log("client (game) connected to server"),u.on("sensor",function(e){console.log("data: "+e.message),i=e.message}),u.on("pressure",function(e){})}),c=this.physics.add.group({bounceY:.2,collideWorldBounds:!0}),u.on("currentPlayers",function(t){Object.keys(t).forEach(function(s){t[s].playerId===u.id?e.addPlayer(e,t[s],function(){e.initializeColliders(e)}):e.addOtherPlayers(e,t[s])})}),u.on("newPlayer",function(t){e.addOtherPlayers(e,t)}),u.on("disconnect",function(e){c.getChildren().forEach(function(t){e===t.playerId&&t.destroy()})}),u.on("gameOver",function(t){var s=t;e.physics.pause(),c&&c.getChildren().forEach(function(e){e.playerId==s&&e.setTint(0),e.anims.play("turn")}),r.playerId==t&&r.setTint(0),r.anims.play("turn")}),u.on("playerMoved",function(e){console.log("playerMoved"),c.getChildren().forEach(function(t){e.playerId===t.playerId&&(console.log("Direction: "+e.direction),"left"===e.direction?t.anims.play("left",!0):"right"===e.direction?t.anims.play("right",!0):t.anims.play("turn"),t.setPosition(e.x,e.y))})}),this.add.image(400,300,"sky"),n=this.physics.add.staticGroup(),n.create(400,568,"ground").setScale(2).refreshBody(),n.create(600,400,"ground"),n.create(50,250,"ground"),n.create(750,220,"ground"),this.anims.create({key:"left",frames:this.anims.generateFrameNumbers("dude",{start:0,end:3}),frameRate:10,repeat:-1}),this.anims.create({key:"turn",frames:[{key:"dude",frame:4}],frameRate:20}),this.anims.create({key:"right",frames:this.anims.generateFrameNumbers("dude",{start:5,end:8}),frameRate:10,repeat:-1}),u.on("starLocation",function(t){o=e.physics.add.image(t.x,t.y,"star"),e.physics.add.collider(o,n),o.setBounceY(Phaser.Math.FloatBetween(.4,.6)),console.log("Created new star!"),e.physics.add.overlap(r,o,function(){o&&o.destroy(),console.log("Destroyed collected star"),u.emit("starCollected")},null,e)}),a=this.physics.add.group(),this.physics.add.collider(a,n),u.on("bombLocation",function(e){console.log("bombLocation message received");var t=a.create(e.x,e.y,"bomb");t.setBounce(1),t.setCollideWorldBounds(!0),t.setVelocity(e.velocityX,e.velocityY),t.allowGravity=!1}),l=this.add.text(16,16,"",{fontSize:"32px",fill:"#0000FF"}),d=this.add.text(584,16,"",{fontSize:"32px",fill:"#FF0000"}),u.on("scoreUpdate",function(e){l.setText("Blue: "+e.blue),d.setText("Red: "+e.red)}),this.cursors=this.input.keyboard.createCursorKeys(),this.input.keyboard.once("keydown_Q",this.quit,this),this.input.keyboard.once("keydown_R",this.restart,this)},update:function(){if(r){this.cursors.left.isDown||"left"==i?(r.setVelocityX(-160),r.anims.play("left",!0)):this.cursors.right.isDown||"right"==i?(r.setVelocityX(160),r.anims.play("right",!0)):"turn"==i?(r.setVelocityX(0),r.anims.play("turn")):(r.setVelocityX(0),r.anims.play("turn")),(this.cursors.up.isDown||"up"==i)&&r.body.touching.down&&r.setVelocityY(-330);var e=r.x,t=r.y;!r.oldPosition||e===r.oldPosition.x&&t===r.oldPosition.y||u.emit("playerMovement",{x:r.x,y:r.y}),r.oldPosition={x:r.x,y:r.y}}},extend:{score:0,quit:function(){this.scene.start("menu")},restart:function(){this.scene.restart()},shutdown:function(){this.registry.set("score",this.score)},addPlayer:function(e,t,s){r=e.physics.add.sprite(t.x,t.y,"dude"),r.setBounce(.2),r.setCollideWorldBounds(!0),"blue"===t.team?r.setTint(255):r.setTint(16711680),r.playerId=t.playerId,s(e)},addOtherPlayers:function(e,t){var s=e.add.sprite(t.x,t.y,"dude");e.physics.add.collider(s,n),"blue"===t.team?s.setTint(255):s.setTint(16711680),s.playerId=t.playerId,c.add(s)},initializeColliders:function(e){e.physics.add.collider(r,n),e.physics.add.collider(r,a,e.hitBomb,null,e)},hitBomb:function(e,t){console.log("Inside hitBomb"),u.emit("endGame",u.id)}}}}),require.register("scenes/menu.js",function(e,t,s){var i=t("data/const");s.exports={key:"menu",init:function(e){console.debug("init",this.scene.key,e,this)},create:function(){var e=this;this.add.image(400,300,"sky").setAlpha(.5),this.startText=this.add.text(400,300,"START",{fill:"white",fontFamily:i.fonts["default"],fontSize:48}).setOrigin(.5).setShadow(0,1,i.colors.aqua,10),this.calibrationText=this.add.text(400,450,"Calibration",{fill:i.colors.aqua,fontFamily:i.fonts["default"],fontSize:30}).setOrigin(.5).setShadow(0,1,"black",5),this.startText.setInteractive(new Phaser.Geom.Rectangle(0,0,this.startText.width,this.startText.height),Phaser.Geom.Rectangle.Contains),this.calibrationText.setInteractive(new Phaser.Geom.Rectangle(0,0,this.calibrationText.width,this.calibrationText.height),Phaser.Geom.Rectangle.Contains),this.input.on("pointerover",function(e,t){t[0].setTint(16776960)}),this.input.on("pointerout",function(e,t){t[0].clearTint()}),this.startText.on("pointerdown",function(t){e.scene.start("default")})},extend:{}}}),require.register("___globals___",function(e,t,s){})}(),require("___globals___"),require("initialize");